library(lm.beta) #standardized beta coefficients
library(lmtest) #Breusch-Pagan test for heterskedasticity
library(car) #VIF
library(sandwich) #robust standard errors
library(ggplot2)

#Define order of levels for categorical variables
df$group <- factor(df$group, levels = c("A", "B", "C"))

# Visualize Relationship with fit line
ggplot(df, aes(x = VARNAME, y = VARNAME)) +
  geom_jitter(width = 0.3, height = 0.3, alpha = 0.5) +  
  geom_smooth(method = "loess", se = FALSE) + 
  labs(x = "VARNAME", y = "VARNAME") +
  theme_minimal()  

# Correlation
cor.test(df$x,df$y,method="pearson") 

# Simple Regression
sreg <- lm(y ~ x 
                  , data = df)
summary(sreg)

poly <- lm(y ~ poly(x, degree = 2), data = df)  # Polynomial regression to assess nonlinearity
summary(poly)


#Specify Model
mod <- lm(y ~  x1 + as.factor(x2), 
                  data = df)
#diagnostics
vif(mod) #multicollinearity check
plot(mod, 1) #visual heteroskedasticity check
bptest(mod) #statistical heteroskedasticity check, sensitive to sample size
hist(mod$residuals) #residual normality check

#model summary
summary(mod) #unstandardized regression without robust standard errors

coeftest(mod, vcov = vcovHC(mod, type = "HC0")) #unstandardized reg w/ robust se
#https://www.brodrigues.co/blog/2018-07-08-rob_stderr/
#https://www.rdocumentation.org/packages/sandwich/versions/3.0-2/topics/vcovHC
#https://research.wu.ac.at/ws/portalfiles/portal/18955008/document.pdf

lm.beta(mod) #standardized coefficients

#RELATIVE WEIGHTS ANALYSIS
library(rwa)

df %>%
    rwa(outcome = "y",
        predictors = c("var1",
                       "var2",
                       "var3"),
        applysigns = TRUE)












